UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ds_reduzida = 'Sim' 
                              AND saneamento_materiais.dt_san_ds_reduzida::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ds_reduzida = 'Sim'
                                      AND saneamento_materiais.dt_san_ds_reduzida::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ds_reduzida = 'Sim'
                                   AND saneamento_materiais.dt_san_ds_reduzida::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'DS_REDUZIDA'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ie_tipo_material = 'Sim' 
                              AND saneamento_materiais.dt_san_ie_tipo_material::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_tipo_material = 'Sim'
                                      AND saneamento_materiais.dt_san_ie_tipo_material::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_tipo_material = 'Sim'
                                   AND saneamento_materiais.dt_san_ie_tipo_material::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'IE_TIPO_MATERIAL'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_cd_unidade_medida_compra = 'Sim' 
                              AND saneamento_materiais.dt_san_cd_unidade_medida_compra::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_cd_unidade_medida_compra = 'Sim'
                                      AND saneamento_materiais.dt_san_cd_unidade_medida_compra::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_cd_unidade_medida_compra = 'Sim'
                                   AND saneamento_materiais.dt_san_cd_unidade_medida_compra::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'CD_UNIDADE_MEDIDA_COMPRA'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_cd_unidade_medida_consumo = 'Sim' 
                              AND saneamento_materiais.dt_san_cd_unidade_medida_consumo::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_cd_unidade_medida_consumo = 'Sim'
                                      AND saneamento_materiais.dt_san_cd_unidade_medida_consumo::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_cd_unidade_medida_consumo = 'Sim'
                                   AND saneamento_materiais.dt_san_cd_unidade_medida_consumo::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'CD_UNIDADE_MEDIDA_CONSUMO'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_cd_unidade_medida_solic = 'Sim' 
                              AND saneamento_materiais.dt_san_cd_unidade_medida_solic::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_cd_unidade_medida_solic = 'Sim'
                                      AND saneamento_materiais.dt_san_cd_unidade_medida_solic::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_cd_unidade_medida_solic = 'Sim'
                                   AND saneamento_materiais.dt_san_cd_unidade_medida_solic::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'CD_UNIDADE_MEDIDA_SOLIC'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_cd_material_generico = 'Sim' 
                              AND saneamento_materiais.dt_san_cd_material_generico::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_cd_material_generico = 'Sim'
                                      AND saneamento_materiais.dt_san_cd_material_generico::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_cd_material_generico = 'Sim'
                                   AND saneamento_materiais.dt_san_cd_material_generico::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'CD_MATERIAL_GENERICO'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_cd_material_estoque = 'Sim' 
                              AND saneamento_materiais.dt_san_cd_material_estoque::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_cd_material_estoque = 'Sim'
                                      AND saneamento_materiais.dt_san_cd_material_estoque::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_cd_material_estoque = 'Sim'
                                   AND saneamento_materiais.dt_san_cd_material_estoque::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'CD_MATERIAL_ESTOQUE'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ie_via_aplicacao = 'Sim' 
                              AND saneamento_materiais.dt_san_ie_via_aplicacao::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_via_aplicacao = 'Sim'
                                      AND saneamento_materiais.dt_san_ie_via_aplicacao::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_via_aplicacao = 'Sim'
                                   AND saneamento_materiais.dt_san_ie_via_aplicacao::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'IE_VIA_APLICACAO'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ie_situacao = 'Sim' 
                              AND saneamento_materiais.dt_san_ie_situacao::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_situacao = 'Sim'
                                      AND saneamento_materiais.dt_san_ie_situacao::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_situacao = 'Sim'
                                   AND saneamento_materiais.dt_san_ie_situacao::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'IE_SITUACAO'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ie_obrig_via_aplicacao = 'Sim' 
                              AND saneamento_materiais.dt_san_ie_obrig_via_aplicacao::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_obrig_via_aplicacao = 'Sim'
                                      AND saneamento_materiais.dt_san_ie_obrig_via_aplicacao::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_obrig_via_aplicacao = 'Sim'
                                   AND saneamento_materiais.dt_san_ie_obrig_via_aplicacao::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'IE_OBRIG_VIA_APLICACAO'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ie_receita = 'Sim' 
                              AND saneamento_materiais.dt_san_ie_receita::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_receita = 'Sim'
                                      AND saneamento_materiais.dt_san_ie_receita::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_receita = 'Sim'
                                   AND saneamento_materiais.dt_san_ie_receita::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'IE_RECEITA'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ie_cobra_paciente = 'Sim' 
                              AND saneamento_materiais.dt_san_ie_cobra_paciente::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_cobra_paciente = 'Sim'
                                      AND saneamento_materiais.dt_san_ie_cobra_paciente::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_cobra_paciente = 'Sim'
                                   AND saneamento_materiais.dt_san_ie_cobra_paciente::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'IE_COBRA_PACIENTE'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ie_inf_ultima_compra = 'Sim' 
                              AND saneamento_materiais.dt_san_ie_inf_ultima_compra::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_inf_ultima_compra = 'Sim'
                                      AND saneamento_materiais.dt_san_ie_inf_ultima_compra::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_inf_ultima_compra = 'Sim'
                                   AND saneamento_materiais.dt_san_ie_inf_ultima_compra::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'IE_INF_ULTIMA_COMPRA'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ie_curva_abc = 'Sim' 
                              AND saneamento_materiais.dt_san_ie_curva_abc::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_curva_abc = 'Sim'
                                      AND saneamento_materiais.dt_san_ie_curva_abc::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_curva_abc = 'Sim'
                                   AND saneamento_materiais.dt_san_ie_curva_abc::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'IE_CURVA_ABC'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_nr_seq_fabric = 'Sim' 
                              AND saneamento_materiais.dt_san_nr_seq_fabric::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_nr_seq_fabric = 'Sim'
                                      AND saneamento_materiais.dt_san_nr_seq_fabric::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_nr_seq_fabric = 'Sim'
                                   AND saneamento_materiais.dt_san_nr_seq_fabric::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'NR_SEQ_FABRIC'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_qt_conv_estoque_consumo = 'Sim' 
                              AND saneamento_materiais.dt_san_qt_conv_estoque_consumo::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_qt_conv_estoque_consumo = 'Sim'
                                      AND saneamento_materiais.dt_san_qt_conv_estoque_consumo::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_qt_conv_estoque_consumo = 'Sim'
                                   AND saneamento_materiais.dt_san_qt_conv_estoque_consumo::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'QT_CONV_ESTOQUE_CONSUMO'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_qt_minimo_multiplo_solic = 'Sim' 
                              AND saneamento_materiais.dt_san_qt_minimo_multiplo_solic::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_qt_minimo_multiplo_solic = 'Sim'
                                      AND saneamento_materiais.dt_san_qt_minimo_multiplo_solic::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_qt_minimo_multiplo_solic = 'Sim'
                                   AND saneamento_materiais.dt_san_qt_minimo_multiplo_solic::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'QT_MINIMO_MULTIPLO_SOLIC'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_qt_prioridade_coml = 'Sim' 
                              AND saneamento_materiais.dt_san_qt_prioridade_coml::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_qt_prioridade_coml = 'Sim'
                                      AND saneamento_materiais.dt_san_qt_prioridade_coml::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_qt_prioridade_coml = 'Sim'
                                   AND saneamento_materiais.dt_san_qt_prioridade_coml::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'QT_PRIORIDADE_COML'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_nr_seq_familia = 'Sim' 
                              AND saneamento_materiais.dt_san_nr_seq_familia::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_nr_seq_familia = 'Sim'
                                      AND saneamento_materiais.dt_san_nr_seq_familia::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_nr_seq_familia = 'Sim'
                                   AND saneamento_materiais.dt_san_nr_seq_familia::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'NR_SEQ_FAMILIA'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_cd_material_conta = 'Sim' 
                              AND saneamento_materiais.dt_san_cd_material_conta::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_cd_material_conta = 'Sim'
                                      AND saneamento_materiais.dt_san_cd_material_conta::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_cd_material_conta = 'Sim'
                                   AND saneamento_materiais.dt_san_cd_material_conta::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'CD_MATERIAL_CONTA'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ie_material_estoque = 'Sim' 
                              AND saneamento_materiais.dt_san_ie_material_estoque::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_material_estoque = 'Sim'
                                      AND saneamento_materiais.dt_san_ie_material_estoque::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_material_estoque = 'Sim'
                                   AND saneamento_materiais.dt_san_ie_material_estoque::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'IE_MATERIAL_ESTOQUE'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ie_baixa_estoq_pac = 'Sim' 
                              AND saneamento_materiais.dt_san_ie_baixa_estoq_pac::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_baixa_estoq_pac = 'Sim'
                                      AND saneamento_materiais.dt_san_ie_baixa_estoq_pac::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_baixa_estoq_pac = 'Sim'
                                   AND saneamento_materiais.dt_san_ie_baixa_estoq_pac::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'IE_BAIXA_ESTOQ_PAC'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ie_padronizado = 'Sim' 
                              AND saneamento_materiais.dt_san_ie_padronizado::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_padronizado = 'Sim'
                                      AND saneamento_materiais.dt_san_ie_padronizado::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_padronizado = 'Sim'
                                   AND saneamento_materiais.dt_san_ie_padronizado::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'IE_PADRONIZADO'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ie_curva_xyz = 'Sim' 
                              AND saneamento_materiais.dt_san_ie_curva_xyz::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_curva_xyz = 'Sim'
                                      AND saneamento_materiais.dt_san_ie_curva_xyz::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_curva_xyz = 'Sim'
                                   AND saneamento_materiais.dt_san_ie_curva_xyz::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'IE_CURVA_XYZ'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_nr_registro_anvisa = 'Sim' 
                              AND saneamento_materiais.dt_san_nr_registro_anvisa::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_nr_registro_anvisa = 'Sim'
                                      AND saneamento_materiais.dt_san_nr_registro_anvisa::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_nr_registro_anvisa = 'Sim'
                                   AND saneamento_materiais.dt_san_nr_registro_anvisa::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'NR_REGISTRO_ANVISA'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_dt_validade_reg_anvisa = 'Sim' 
                              AND saneamento_materiais.dt_san_dt_san_validade_reg_anvisa::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_dt_validade_reg_anvisa = 'Sim'
                                      AND saneamento_materiais.dt_san_dt_san_validade_reg_anvisa::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_dt_validade_reg_anvisa = 'Sim'
                                   AND saneamento_materiais.dt_san_dt_san_validade_reg_anvisa::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'DT_VALIDADE_REG_ANVISA'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ie_vigente_anvisa = 'Sim' 
                              AND saneamento_materiais.dt_san_ie_vigente_anvisa::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_vigente_anvisa = 'Sim'
                                      AND saneamento_materiais.dt_san_ie_vigente_anvisa::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_vigente_anvisa = 'Sim'
                                   AND saneamento_materiais.dt_san_ie_vigente_anvisa::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'IE_VIGENTE_ANVISA'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ie_reg_anvisa_isento = 'Sim' 
                              AND saneamento_materiais.dt_san_ie_reg_anvisa_isento::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_reg_anvisa_isento = 'Sim'
                                      AND saneamento_materiais.dt_san_ie_reg_anvisa_isento::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_reg_anvisa_isento = 'Sim'
                                   AND saneamento_materiais.dt_san_ie_reg_anvisa_isento::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'IE_REG_ANVISA_ISENTO'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ds_motivo_isencao_anvisa = 'Sim' 
                              AND saneamento_materiais.dt_san_ds_motivo_isencao_anvisa::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ds_motivo_isencao_anvisa = 'Sim'
                                      AND saneamento_materiais.dt_san_ds_motivo_isencao_anvisa::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ds_motivo_isencao_anvisa = 'Sim'
                                   AND saneamento_materiais.dt_san_ds_motivo_isencao_anvisa::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'DS_MOTIVO_ISENCAO_ANVISA'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ie_unid_consumo_prescr = 'Sim' 
                              AND saneamento_materiais.dt_san_ie_unid_consumo_prescr::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_unid_consumo_prescr = 'Sim'
                                      AND saneamento_materiais.dt_san_ie_unid_consumo_prescr::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_unid_consumo_prescr = 'Sim'
                                   AND saneamento_materiais.dt_san_ie_unid_consumo_prescr::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'IE_UNID_CONSUMO_PRESCR'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_nr_seq_ficha_tecnica = 'Sim' 
                              AND saneamento_materiais.dt_san_nr_seq_ficha_tecnica::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_nr_seq_ficha_tecnica = 'Sim'
                                      AND saneamento_materiais.dt_san_nr_seq_ficha_tecnica::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_nr_seq_ficha_tecnica = 'Sim'
                                   AND saneamento_materiais.dt_san_nr_seq_ficha_tecnica::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'NR_SEQ_FICHA_TECNICA'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ie_alto_risco = 'Sim' 
                              AND saneamento_materiais.dt_san_ie_alto_risco::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_alto_risco = 'Sim'
                                      AND saneamento_materiais.dt_san_ie_alto_risco::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_alto_risco = 'Sim'
                                   AND saneamento_materiais.dt_san_ie_alto_risco::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'IE_ALTO_RISCO'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ie_multidose = 'Sim' 
                              AND saneamento_materiais.dt_san_ie_multidose::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_multidose = 'Sim'
                                      AND saneamento_materiais.dt_san_ie_multidose::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_multidose = 'Sim'
                                   AND saneamento_materiais.dt_san_ie_multidose::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'IE_MULTIDOSE'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_cd_medicamento = 'Sim' 
                              AND saneamento_materiais.dt_san_cd_medicamento::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_cd_medicamento = 'Sim'
                                      AND saneamento_materiais.dt_san_cd_medicamento::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_cd_medicamento = 'Sim'
                                   AND saneamento_materiais.dt_san_cd_medicamento::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'CD_MEDICAMENTO'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ie_solucao = 'Sim' 
                              AND saneamento_materiais.dt_san_ie_solucao::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_solucao = 'Sim'
                                      AND saneamento_materiais.dt_san_ie_solucao::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_solucao = 'Sim'
                                   AND saneamento_materiais.dt_san_ie_solucao::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'IE_SOLUCAO'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ie_controle_medico = 'Sim' 
                              AND saneamento_materiais.dt_san_ie_controle_medico::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_controle_medico = 'Sim'
                                      AND saneamento_materiais.dt_san_ie_controle_medico::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_controle_medico = 'Sim'
                                   AND saneamento_materiais.dt_san_ie_controle_medico::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'IE_CONTROLE_MEDICO'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_cd_unidade_medida = 'Sim' 
                              AND saneamento_materiais.dt_san_cd_unidade_medida::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_cd_unidade_medida = 'Sim'
                                      AND saneamento_materiais.dt_san_cd_unidade_medida::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_cd_unidade_medida = 'Sim'
                                   AND saneamento_materiais.dt_san_cd_unidade_medida::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'CD_UNIDADE_MEDIDA'
    AND gcm_saneamento.ds_tabela = 'MATERIAL_CONVERSAO_UNIDADE'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ie_tempo_estab = 'Sim' 
                              AND saneamento_materiais.dt_san_ie_tempo_estab::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_tempo_estab = 'Sim'
                                      AND saneamento_materiais.dt_san_ie_tempo_estab::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_tempo_estab = 'Sim'
                                   AND saneamento_materiais.dt_san_ie_tempo_estab::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'IE_TEMPO_ESTAB'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;

UPDATE 
    analytics.gcm_saneamento
SET
   flag_tipo_saneamento = CASE WHEN saneamento_materiais.flag_ie_regra = 'Sim' 
                              AND saneamento_materiais.dt_san_ie_regra::DATE <= gcm_saneamento.dt_alteracao::DATE
                              AND gcm_saneamento.flag_tipo = 'Carga' THEN 'Saneamento em Produção'
                         END
, flag_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_regra = 'Sim'
                                      AND saneamento_materiais.dt_san_ie_regra::DATE < gcm_saneamento.dt_alteracao::DATE
                                      AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 'Sim'
                                     ELSE 'Não'
                               END
, qtd_ajuste_pos_saneamento = CASE WHEN saneamento_materiais.flag_ie_regra = 'Sim'
                                   AND saneamento_materiais.dt_san_ie_regra::DATE < gcm_saneamento.dt_alteracao::DATE
                                   AND gcm_saneamento.flag_tipo NOT IN ('Carga') THEN 1
                                   ELSE 0
                              END
FROM
    ingestion.saneamento_materiais
WHERE
    saneamento_materiais.cd_material = gcm_saneamento.cd_material
    AND gcm_saneamento.ds_campo = 'IE_REGRA'
    AND gcm_saneamento.ds_tabela = 'MATERIAL'
;
